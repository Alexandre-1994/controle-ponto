<ion-header>
  <ion-toolbar>
    <ion-title>Relatório de Presenças</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-grid>
    <ion-row>
      <ion-col size="3">
        <ion-item>
          <ion-label position="stacked">Data Inicial</ion-label>
          <ion-input
            type="date"
            [(ngModel)]="startDate"
            (ionChange)="onDateChange()"
            class="ion-text-start">
          </ion-input>
        </ion-item>
      </ion-col>
      <ion-col size="3">
        <ion-item>
          <ion-label position="stacked">Data Final</ion-label>
          <ion-input
            type="date"
            [(ngModel)]="endDate"
            (ionChange)="onDateChange()"
            class="ion-text-start">
          </ion-input>
        </ion-item>
      </ion-col>
      <ion-col size="3">
        <ion-item>
          <ion-label position="stacked">Departamento</ion-label>
          <ion-select [(ngModel)]="selectedDepartment" (ionChange)="onFilterChange()">
            <ion-select-option value="">Todos</ion-select-option>
            <ion-select-option *ngFor="let dept of departments" [value]="dept.id">
              {{ dept.name }}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </ion-col>
      <ion-col size="3">
        <ion-item>
          <ion-label position="stacked">Funcionário</ion-label>
          <ion-select [(ngModel)]="selectedEmployee" (ionChange)="onFilterChange()">
            <ion-select-option value="">Todos</ion-select-option>
            <ion-select-option *ngFor="let employee of filteredEmployees" [value]="employee.id">
              {{ employee.name }}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Tabela Detalhada -->
  <ion-button fill="clear"  (click)="exportDetailedReport()" >
    <ion-icon name="download-outline" slot="start"></ion-icon>
    Exportar
  </ion-button>
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        Relatório Detalhado
       
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Código</th>
              <th>Nome</th>
              <!-- <th>Entrada</th>
              <th>Saída</th> -->
              <th>Atraso Total</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let report of paginatedReports">
              <td>{{ report.internal_code }}</td>
              <td>{{ report.employeeName }}</td>
              <!-- <td>{{ report.check_in || '-' }}</td>
              <td>{{ report.check_out || '-' }}</td> -->
              <td [class.negative]="report.totalDelay > 0">
                {{ report.totalDelayHours }}h
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Pagination Controls -->
        <div class="pagination-controls" *ngIf="totalPages > 1">
          <ion-button fill="clear" (click)="previousPage()" [disabled]="currentPage === 1">
            <ion-icon name="chevron-back"></ion-icon>
          </ion-button>
          
          <span class="page-info">
            Página {{ currentPage }} de {{ totalPages }}
          </span>

          <ion-button fill="clear" (click)="nextPage()" [disabled]="currentPage === totalPages">
            <ion-icon name="chevron-forward"></ion-icon>
          </ion-button>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <ion-loading [isOpen]="isLoading" message="Gerando relatório..."></ion-loading>
</ion-content>

<style>
.table-container {
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}

th {
  background-color: #f4f4f4;
  font-weight: bold;
}

.positive {
  color: green;
}

.negative {
  color: red;
}

ion-input[type="date"] {
  --padding-start: 8px;
  cursor: pointer;
}

ion-input[type="date"]::-webkit-calendar-picker-indicator {
  cursor: pointer;
  filter: invert(0.5);
}

.pagination-controls {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 20px;
  gap: 10px;
}

.page-info {
  color: var(--ion-color-medium);
  font-size: 14px;
}
</style>